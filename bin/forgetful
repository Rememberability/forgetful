#!/usr/bin/env ruby

require "forgetful"
require "forgetful/cli"
require 'optparse'

#-------------------------------------------------

def parse(args)
  options = { :filenames => [],
              :verbose   => false,
              :sort_type => :easier_first,
              :action    => :quiz }

  args.options do |arg|
    arg.banner = "Usage: forgetful [OPTION]... [FILE]..."
    arg.separator ""
    arg.separator "Specific options:"

    arg.on(     '-t', '--touch',   "Validate filename(s) and write back in full CSV format") do
      options[:action] = :touch
    end

    arg.on(     '-R', '--random', "Random sort - default is easier first") do
      options[:sort_type] = :random
    end

    arg.separator ""
    arg.separator "Common options:"

    arg.on(     '-v', '--verbose', "Show more information") do
      options[:verbose] = true
    end

    arg.on(           '--version', "Show version") do
      puts File.read(File.join(File.dirname(__FILE__), "..", "VERSION"))
      exit
    end

    arg.on_tail('-h', '--help',    "Show this message") do
      puts arg
      exit
    end

    arg.parse!
  end

  options[:filenames] = args.dup
  args.clear

  options
end

#-------------------------------------------------

options = parse(ARGV)

begin
  options[:filenames].each do |filename|
    ReminderFile.new(filename, options[:sort_type], options[:verbose]).send(options[:action])
  end
rescue Interrupt
  puts
  # aborting ... won't save file
end

